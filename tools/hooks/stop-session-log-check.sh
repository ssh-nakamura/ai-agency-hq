#!/bin/bash
# =============================================================
# AI Agency HQ — Stop hook (セッション終了時自動チェック)
# =============================================================
# セッション終了時にログが保存されているか確認。
# 未保存ならブロックしてCEOに /session-log 実行を強制する。
# =============================================================

REPO_ROOT="$(cd "$(dirname "$0")/../.." && pwd)"
TODAY=$(date +%Y-%m-%d)
LOG_DIR="$REPO_ROOT/content/logs"

# 今日のログが既に存在するなら OK
if ls "$LOG_DIR"/${TODAY}*.md 1>/dev/null 2>&1; then
    exit 0
fi

# ログが存在しない → ブロック
cat <<EOF
セッションログが未保存です（${TODAY}）。
/session-log を実行してからセッションを終了してください。
EOF
exit 1
